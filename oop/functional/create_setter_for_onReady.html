<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>JS-Learn</title>
  </head>
  <body>
    <script>
      function CoffeeMachine(power, capacity) {
        var waterAmount = 0;
        var WATER_HEAT_CAPACITY = 4200;
        var myOnReady;

        function getTimeToBoil() {
          return waterAmount * WATER_HEAT_CAPACITY * 80 / power;
        }

        function onReady() {
          if(myOnReady) { return myOnReady() }
          alert( 'Кофе готов!' );
        }

        this.setWaterAmount = function(amount) {
          // ... проверки пропущены для краткости
          waterAmount = amount;
        };

        this.getWaterAmount = function(amount) {
          return waterAmount;
        };

        this.run = function() {
          setTimeout(onReady, getTimeToBoil());
        };

        this.setOnReady = function(func) {
          myOnReady = func;
        };
      }

      var coffeeMachine = new CoffeeMachine(10000, 500);
      coffeeMachine.setWaterAmount(150);

      coffeeMachine.setOnReady(function() {
        var amount = coffeeMachine.getWaterAmount();
        alert( 'Готов кофе: ' + amount + 'мл' ); // Кофе готов: 150 мл
      });

      coffeeMachine.run();
    </script>
  </body>
</html>
